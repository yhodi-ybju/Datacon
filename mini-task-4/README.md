# Мини‑таск 4: Генерация и отбор молекул‑кандидатов

В этом задании вы завершаете цикл генеративного дизайна лекарств. Используя знания, модели и данные, полученные на предыдущих этапах, вам предстоит сгенерировать новые молекулы-кандидаты и отобрать из них потенциальные хиты с подходящими свойствами.

## Цель

Развернуть одну из существующих генеративных моделей для синтеза малых молекул, адаптировать её (при необходимости) под задачу генерации активных соединений в отношении COX‑2, сгенерировать молекулы и отобрать из них перспективные кандидаты на основе заранее определённых критериев.



## Возможные подходы

Вы можете использовать один или несколько из следующих вариантов:

1. **Дообучение генеративной модели** на датасете активных молекул, полученных в предыдущих мини‑тасках;
2. **Условная генерация**: если используется модель, поддерживающая condition vector (например, по активности, классу, scaffold);
3. **Использование модели из мини‑таска 3** в схеме фильтрации (генерация → предсказание активности → отбор);
4. Любая другая обоснованная стратегия (например, reinforcement learning, genetic algorithms и т.п.).

Выбор архитектуры и метода остаётся за вами. Основное требование — обоснованность и воспроизводимость.



## Примеры моделей, которые можно использовать

Ниже представлены популярные архитектуры генеративных моделей для малых молекул:

| Модель       | Описание                                                         |
|--------------|------------------------------------------------------------------|
| **FREED++**   | Фреймворк для генерации молекул с fine-tuning и conditional sampling |
| **REINVENT**  | Модель последовательной генерации SMILES с возможностью RL‑дообучения |
| **DrugGPT**   | GPT-подобная архитектура для генерации химических структур       |

Эти модели поддерживают настройку на конкретную мишень, генерацию условно активных соединений и могут быть дообучены на специфичных выборках.



## Критерии отбора молекул‑кандидатов

После генерации, необходимо отобрать **валидные и перспективные** молекулы по следующим критериям:

1. **Валидность SMILES**
   - Используйте RDKit для проверки синтаксиса и конвертации в молекулу.

2. **Предсказанная активность**
   - Используйте вашу модель из мини‑таска 3 для предсказания `pIC50`.
   - Оставьте молекулы с:
     ```text
     pIC50 > 6.0
     ```

3. **Молекулярные свойства**
   - Рассчитайте ключевые параметры:

| Свойство    | Метод                                    |
|-------------|-------------------------------------------|
| QED         | `rdkit.Chem.QED.qed()`                    |
| SA Score    | `calculate_sa_score()`                    |
| Toxicophore | Поиск токсичных фрагментов / BRENK       |
| Lipinski    | ≤ 1 нарушение правил Липинского           |

4. **Финальный отбор**

Итоговый список молекул должен соответствовать:

- `pValue > 6.0`
- `QED > 0.7` (в крайнем случае ≥ 0.5)
- `2 < SA Score < 6`
- Отсутствие токсофоров (по SMARTS или BRENK)
- Не более одного нарушения правил Липинского



## Что нужно сдать

- Jupyter Notebook (`.ipynb`), содержащий:
  - описание выбранного подхода;
  - код генерации и отбора молекул;
  - визуализации, пояснения и обоснования.

- Файл `selected_hits.csv`, содержащий:
  - `SMILES`;
  - предсказанный `pIC50`;
  - значения QED, SA Score, Toxicophore (1/0), Lipinski violations;
  - итоговый комментарий по каждой молекуле.
